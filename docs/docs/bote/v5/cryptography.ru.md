# 7. Криптография (ЧЕРНОВИК)

## 7.1. Ассимметричные алгоритмы и электронные подписи

Для шифрования и подписи данных используются заранее определённые наборы алгоритмов.
Каждому набору сообтветствует идентификатор, который используется в зашифрованных данных.

Список используемых алгоритмов:

| ID | Шифрование (согласования ключа) | Электронная подпись | Шифрование (симметричный алгоритм) | Хэш-функция | Java-Bote | pboted  |
|----|---------------------------------|---------------------|------------------------------------|-------------|-----------|---------|
| 1  | ElGamal-2048                    | DSA-1024            | AES-CBC-256                        | SHA-256     | активен   | устарел |
| 2  | ECDH-256                        | ECDSA-256           | AES-CBC-256                        | SHA-256     | активен   | активен |
| 3  | ECDH-521                        | ECDSA-521           | AES-CBC-256                        | SHA-512     | активен   | активен |
| 4  | NTRUEncrypt-1087                | GMSS-512            | AES-CBC-256                        | SHA-512     | активен   | нет     |
| 5  | X25519                          | ED25519             | AES-CBC-256                        | SHA-512     | нет       | активен |

### Форматы Почтовых назначений

#### Версия 0

_Используется в **pboted** и **Java-Bote**_

Почтовое назначение представляем собой строку, закодированную в Base64, которая содержит:

* публичный ключ шифрования (согласования ключа)
* публичный ключ для подтверждения электронной подписи.   

Пример 512-символьной Почтовой Идентичности (ElGamal-2048/DSA-1024):
```
  uQtdwFHqbWHGyxZN8wChjWbCcgWrKuoBRNoziEpE8XDt8koHdJiskYXeUyq7JmpG
  In8WKXY5LNue~62IXeZ-ppUYDdqi5V~9BZrcbpvgb5tjuu3ZRtHq9Vn6T9hOO1fa
  FYZbK-FqHRiKm~lewFjSmfbBf1e6Fb~FLwQqUBTMtKYrRdO1d3xVIm2XXK83k1Da
  -nufGASLaHJfsEkwMMDngg8uqRQmoj0THJb6vRfXzRw4qR5a0nj6dodeBfl2NgL9
  HfOLInwrD67haJqjFJ8r~vVyOxRDJYFE8~f9b7k3N0YeyUK4RJSoiPXtTBLQ2RFQ
  gOaKg4CuKHE0KCigBRU-Fhhc4weUzyU-g~rbTc2SWPlfvZ6n0voSvhvkZI9V52X3
  SptDXk3fAEcwnC7lZzza6RNHurSMDMyOTmppAVz6BD8PB4o4RuWq7MQcnF9znElp
  HX3Q10QdV3omVZJDNPxo-Wf~CpEd88C9ga4pS~QGIHSWtMPLFazeGeSHCnPzIRYD
```

Пример 86-символьной Почтовой Идентичности (ECC-256):
```
  1Lcvly8no5of6juJKxqy-xA-MStM2c2XKorepH1oqs5
  yKBkg9-ZcG4G4kZY1E~2672cMA806l9EicQLmlehB1m
```

Тип почтового назначения может быть определён только по длине base64 строки:

| ID | Публичная часть | Приватная часть |
|----|-----------------|-----------------|
| 1  | 512             | 880             |
| 2  | 86              | 172             |
| 3  | 174             | 348             |
| 4  | 2079            | 97813           |

#### Версия 1

_Используется в **pboted**_

После введения новых алгоритмов для Почтовых назначений возникла проблема неоднозначности определения типа Почтового назначения по его длине в формате base64.  
Был разработан более полный формат Почтового назначения, который дополнительно позволяет использовать различные комбинации алгоритмов, а не только несколько предопределённых.

Шаблон:
`<data format>.<encoded data>`

- data format - сообщает об используемом кодировании, на данный момент может быть:
	- **b32** (`base32`)
	- **b64** (`base64`)
- encoded data - кодированные байты с:
	- Почтовым назначением (*только публичные ключи*)
	- Почтовой идентичностью (*публичные и приватные ключи*)

Почтовое назначение:

| Поле     | Размер | Описание                                               |
|----------|--------|--------------------------------------------------------|
| `VER`    | 1 byte | Версия формата                                         |
| `CTYPE`  | 1 byte | Тип шифрования (согласования ключа)                    |
| `STYPE`  | 1 byte | Тип электронной подписи                                |
| `SMTYPE` | 1 byte | Тип щифрования (симметричный алгоритм)                 |
| `HTYPE`  | 1 byte | Тип хэш-функции                                        |
| `CDATA`  | N byte | Публичный ключ шифрования (длина поля зависит от типа) |
| `SDATA`  | M byte | Публичный ключ подписи (длина поля зависит от типа)    |

Почтовая идентичность:

| Поле     | Размер | Описание                                               |
|----------|--------|--------------------------------------------------------|
| `VER`    | 1 byte | Версия формата                                         |
| `CTYPE`  | 1 byte | Тип шифрования (согласования ключа)                    |
| `STYPE`  | 1 byte | Тип электронной подписи                                |
| `SMTYPE` | 1 byte | Тип щифрования (симметричный алгоритм)                 |
| `HTYPE`  | 1 byte | Тип хэш-функции                                        |
| `CDATA`  | N byte | Публичный ключ шифрования (длина поля зависит от типа) |
| `SDATA`  | M byte | Публичный ключ подписи (длина поля зависит от типа)    |
| `CPDATA` | X byte | Приватный ключ шифрования (длина поля зависит от типа) |
| `SPDATA` | Y byte | Приватный ключ подписи (длина поля зависит от типа)    |

Пример:


## 7.3. Отпечатки для записей каталога

ToDo: Looks specific to Java app, remove from protocol description

TODO
H = scrypt(name, dest, zuf.wert); die letzten 8 Binärstellen von H müssen 0 sein
13*7+22+18 = 131
